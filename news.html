<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="PvZ2: SHUTTLE News Page, get the latest updates and announcements here!"
    />
    <title>PvZ2: SHUTTLE News</title>
    <link rel="stylesheet" href="/assets/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
  </head>
  <body>
    <div id="loading-overlay" class="loading-overlay">
      <div class="lds-default">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="navbar">
      <div class="navbar-left">
        <a href="/" class="navbar-btn" id="home-btn" aria-label="Home Page"></a>
        <a
          href="/news/"
          class="navbar-btn"
          id="news-btn"
          aria-label="News Page"
        ></a>
      </div>
      <div class="navbar-right">
        <div class="lang-switch" id="lang-switch">
          <button class="lang-switch-btn" id="lang-switch-btn" aria-label="Select Language">
            <!-- SVG will be injected here by JS -->
          </button>
          <div class="lang-dropdown" id="lang-dropdown">
            <a href="#" data-lang="en-US">English</a>
            <a href="#" data-lang="zh-CN">简体中文</a>
          </div>
        </div>
      </div>
    </div>

    <div class="overlay">
      <div class="header-container">
        <img class="logo" id="game-icon" src="" alt="Game Icon" />
        <img id="game-title-logo" src="" alt="Title Logo" />
      </div>

      <div class="card" id="news-content-area"></div>
    </div>
    <script type="module">
      import { showLoader, hideLoader } from '/js/main.js'

      let appConfig

      async function loadInitialData() {
        showLoader() // 显示加载器

        try {
          const configRes = await fetch(
            new URL('/assets/config.json', window.location.origin)
          )
          appConfig = await configRes.json()

          const mainModule = await import(
            new URL(appConfig.mainJs, window.location.origin)
          )
          await mainModule.init(
            // 确保这里等待 main.js 的 init 完成，它现在包含了图片和字体等待逻辑
            appConfig,
            appConfig.textsJson,
            appConfig.iconsJs,
            appConfig.styleCss
          )

          // 仅在 news.html 或新闻相关路径时加载 newsModule
          const currentPathname = window.location.pathname
          if (
            currentPathname.startsWith('/news/') ||
            currentPathname.endsWith('/news.html') ||
            currentPathname === '/news/'
          ) {
            const newsModule = await import(
              new URL(appConfig.newsJs, window.location.origin)
            )
            await newsModule.initNews(appConfig, appConfig.newsJson) // 确保这里等待 news.js 的 initNews 完成
          }
        } catch (error) {
          console.error('初始数据加载期间出错:', error)
        } finally {
          hideLoader() // 所有 await 操作完成后，才隐藏加载器
        }
      }

      // 确保只监听一次 DOMContentLoaded 事件
      document.addEventListener('DOMContentLoaded', loadInitialData)
    </script>
  </body>
</html>
